
/*****
*
* Copyright (C) 2004-2016 CS-SI. All Rights Reserved.
* Author: Yoann Vandoorselaere <yoann.v@libiodef-ids.com>
* Author: Nicolas Delon <nicolas.delon@libiodef-ids.com>
*
* This file is part of the LibIodef library.
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation; either version 2, or (at your option)
* any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License along
* with this program; if not, write to the Free Software Foundation, Inc.,
* 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
*
*****/

/* Auto-generated by the GenerateIODEFMessagePrintJSONC package */

#include "config.h"
#include "libmissing.h"

#include <stdio.h>
#include <string.h>

#include "iodef.h"
#include "iodef-tree-wrap.h"
#include "iodef-document-print-json.h"


#define conv_uint8 conv_uint64
#define conv_uint16 conv_uint64
#define conv_uint32 conv_uint64
#define conv_int8 conv_int64
#define conv_int16 conv_int64
#define conv_int32 conv_int64


static int conv_uint64(libiodef_io_t *fd, uint64_t value)
{
        int ret;
        char buf[32];

        ret = snprintf(buf, sizeof(buf), "%" LIBIODEF_PRIu64, value);
        if ( ret < 0 || ret >= sizeof(buf) )
                return -1;

        return libiodef_io_write(fd, buf, ret);
}


static int conv_int64(libiodef_io_t *fd, int64_t value)
{
        int ret;
        char buf[32];

        ret = snprintf(buf, sizeof(buf), "%" LIBIODEF_PRId64, value);
        if ( ret < 0 || ret >= sizeof(buf) )
                return -1;

        return libiodef_io_write(fd, buf, ret);
}


static int conv_float(libiodef_io_t *fd, float value)
{
        int ret;
        char buf[32];

        ret = snprintf(buf, sizeof(buf), "%f", value);
        if ( ret < 0 || ret >= sizeof(buf) )
                return -1;

        return libiodef_io_write(fd, buf, ret);
}


static int conv_string(libiodef_io_t *fd, libiodef_string_t *string)
{
        size_t i;
        ssize_t ret;
        const unsigned char *content;

        content = (const unsigned char *) libiodef_string_get_string_or_default(string, "");
        ret = libiodef_io_write(fd, "\"", 1);
        if ( ret < 0 )
                return ret;

        for ( i = 0; i < libiodef_string_get_len(string); i++, content++ ) {
                switch(*content) {
                        case '\\':
                        case '"':
                        case '/':
                                ret = libiodef_io_write(fd, "\\", 1);
                                if ( ret < 0 )
                                        return ret;

                                ret = libiodef_io_write(fd, content, 1);
                                break;
                        case '\b':
                                ret = libiodef_io_write(fd, "\\b", 2);
                                break;
                        case '\t':
                                ret = libiodef_io_write(fd, "\\t", 2);
                                break;
                        case '\n':
                                ret = libiodef_io_write(fd, "\\n", 2);
                                break;
                        case '\f':
                                ret = libiodef_io_write(fd, "\\f", 2);
                                break;
                        case '\r':
                                ret = libiodef_io_write(fd, "\\r", 2);
                                break;
                        default:
                                if ( *content >= 0x20 )
                                        ret = libiodef_io_write(fd, content, 1);
                                else {
                                        char seq[7];
                                        snprintf(seq, sizeof(seq), "\\u%04X", *content);
                                        ret = libiodef_io_write(fd, seq, strlen(seq));
                                }
                }

                if ( ret < 0 )
                        return ret;
        }

        return libiodef_io_write(fd, "\"", 1);
}


static int conv_time(libiodef_io_t *fd, iodef_time_t *t)
{
        int ret;
        libiodef_string_t *str;

        if ( ! t )
                return 0;

        ret = libiodef_string_new(&str);
        if ( ret < 0 )
                return ret;

        ret = iodef_time_to_string(t, str);
        if ( ret < 0 )
                goto error;

        ret = conv_string(fd, str);

error:
        libiodef_string_destroy(str);
        return ret;
}


static int conv_data(libiodef_io_t *fd, iodef_data_t *data)
{
        int ret;
        libiodef_string_t *out;

        ret = libiodef_string_new(&out);
        if ( ret < 0 )
                return ret;

        ret = iodef_data_to_string(data, out);
        if ( ret < 0 )
                goto error;

        switch (iodef_data_get_type(data)) {
                case IODEF_DATA_TYPE_INT:
                case IODEF_DATA_TYPE_FLOAT:
                        ret = libiodef_io_write(fd, libiodef_string_get_string(out), libiodef_string_get_len(out));
                        break;
                default:
                        ret = conv_string(fd, out);
                        break;
        }
error:
        libiodef_string_destroy(out);
        return ret;
}


static int do_write(libiodef_io_t *fd, const char *str)
{
        return libiodef_io_write(fd, str, strlen(str));
}


/**
 * iodef_additional_data_json:
 * @ptr: Pointer to an iodef_additional_data_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_additional_data_print_json(iodef_additional_data_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_additional_data_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_additional_data_get_restriction(ptr);

                {
                        const char *enumstr = iodef_additional_data_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_additional_data_get_type(ptr);

                {
                        const char *enumstr = iodef_additional_data_type_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"type\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_additional_data_get_formatid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"formatid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_additional_data_get_meaning(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"meaning\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_additional_data_get_ext_dtype(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_dtype\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_data_t *field;

                field = iodef_additional_data_get_data(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"data\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_data(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_email_json:
 * @ptr: Pointer to an iodef_email_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_email_print_json(iodef_email_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_email_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_email_get_meaning(ptr);

                {
                        const char *enumstr = iodef_email_meaning_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"meaning\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_email_get_email(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"email\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_registry_handle_json:
 * @ptr: Pointer to an iodef_registry_handle_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_registry_handle_print_json(iodef_registry_handle_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_registry_handle_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_registry_handle_get_registry(ptr);

                {
                        const char *enumstr = iodef_registry_handle_registry_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"registry\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_registry_handle_get_ext_registry(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_registry\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_postal_address_json:
 * @ptr: Pointer to an iodef_postal_address_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_postal_address_print_json(iodef_postal_address_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_postal_address_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_postal_address_get_lang(ptr);

                {
                        const char *enumstr = iodef_postal_address_lang_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"lang\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_postal_address_get_meaning(ptr);

                {
                        const char *enumstr = iodef_postal_address_meaning_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"meaning\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_contact_json:
 * @ptr: Pointer to an iodef_contact_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_contact_print_json(iodef_contact_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_contact_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_contact_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_contact_get_fax(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"fax\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_contact_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_contact_get_next_telephone(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"telephone\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_registry_handle_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_contact_get_next_registry_handle(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"registry_handle\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_registry_handle_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_contact_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_contact_get_next_contact(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"contact\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_contact_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_contact_get_contact_name(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"contact_name\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_contact_get_timezone(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"timezone\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_postal_address_t *field;

                field = iodef_contact_get_postal_address(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"postal_address\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_postal_address_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_email_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_contact_get_next_email(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"email\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_email_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_contact_get_type(ptr);

                {
                        const char *enumstr = iodef_contact_type_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"type\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_contact_get_role(ptr);

                {
                        const char *enumstr = iodef_contact_role_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"role\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_contact_get_ext_type(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_type\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_contact_get_ext_role(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_role\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_contact_get_restriction(ptr);

                {
                        const char *enumstr = iodef_contact_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_incident_id_json:
 * @ptr: Pointer to an iodef_incident_id_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_incident_id_print_json(iodef_incident_id_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_incident_id_t\"");
        if ( ret < 0 )
                return ret;


        {
                libiodef_string_t *field;

                field = iodef_incident_id_get_instance(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"instance\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_incident_id_get_name(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"name\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_incident_id_get_restriction(ptr);

                {
                        const char *enumstr = iodef_incident_id_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_alternative_id_json:
 * @ptr: Pointer to an iodef_alternative_id_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_alternative_id_print_json(iodef_alternative_id_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_alternative_id_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_incident_id_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_alternative_id_get_next_incident_id(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"incident_id\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_incident_id_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_alternative_id_get_restriction(ptr);

                {
                        const char *enumstr = iodef_alternative_id_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_related_activity_json:
 * @ptr: Pointer to an iodef_related_activity_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_related_activity_print_json(iodef_related_activity_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_related_activity_t\"");
        if ( ret < 0 )
                return ret;


        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_related_activity_get_next_url(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"url\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_incident_id_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_related_activity_get_next_incident_id(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"incident_id\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_incident_id_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_related_activity_get_restriction(ptr);

                {
                        const char *enumstr = iodef_related_activity_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_history_item_json:
 * @ptr: Pointer to an iodef_history_item_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_history_item_print_json(iodef_history_item_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_history_item_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_history_item_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_incident_id_t *field;

                field = iodef_history_item_get_incident_id(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"incident_id\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_incident_id_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_history_item_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_contact_t *field;

                field = iodef_history_item_get_contact(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"contact\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_contact_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_history_item_get_date_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"date_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_history_item_get_action(ptr);

                {
                        const char *enumstr = iodef_history_item_action_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"action\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_history_item_get_restriction(ptr);

                {
                        const char *enumstr = iodef_history_item_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_history_item_get_ext_action(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_action\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_history_json:
 * @ptr: Pointer to an iodef_history_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_history_print_json(iodef_history_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_history_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_history_item_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_history_get_next_history_item(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"history_item\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_history_item_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_history_get_restriction(ptr);

                {
                        const char *enumstr = iodef_history_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_expectation_json:
 * @ptr: Pointer to an iodef_expectation_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_expectation_print_json(iodef_expectation_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_expectation_t\"");
        if ( ret < 0 )
                return ret;


        {
                iodef_time_t *field;

                field = iodef_expectation_get_end_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"end_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_expectation_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_expectation_get_start_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"start_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_contact_t *field;

                field = iodef_expectation_get_contact(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"contact\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_contact_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_expectation_get_action(ptr);

                {
                        const char *enumstr = iodef_expectation_action_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"action\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_expectation_get_restriction(ptr);

                {
                        const char *enumstr = iodef_expectation_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_expectation_get_ext_action(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_action\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_expectation_get_severity(ptr);

                {
                        const char *enumstr = iodef_expectation_severity_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"severity\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_record_pattern_json:
 * @ptr: Pointer to an iodef_record_pattern_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_record_pattern_print_json(iodef_record_pattern_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_record_pattern_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_record_pattern_get_offsetunit(ptr);

                {
                        const char *enumstr = iodef_record_pattern_offsetunit_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"offsetunit\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                uint32_t *field;

                field = iodef_record_pattern_get_instance(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"instance\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_record_pattern_get_ext_type(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_type\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                uint32_t *field;

                field = iodef_record_pattern_get_offset(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"offset\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_record_pattern_get_ext_offsetunit(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_offsetunit\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_record_pattern_get_type(ptr);

                {
                        const char *enumstr = iodef_record_pattern_type_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"type\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_record_item_json:
 * @ptr: Pointer to an iodef_record_item_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_record_item_print_json(iodef_record_item_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_record_item_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_record_item_get_restriction(ptr);

                {
                        const char *enumstr = iodef_record_item_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_record_item_get_dtype(ptr);

                {
                        const char *enumstr = iodef_record_item_dtype_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"dtype\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_record_item_get_formatid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"formatid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_record_item_get_meaning(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"meaning\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_record_item_get_ext_dtype(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_dtype\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_data_t *field;

                field = iodef_record_item_get_data(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"data\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_data(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_application_json:
 * @ptr: Pointer to an iodef_application_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_application_print_json(iodef_application_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_application_t\"");
        if ( ret < 0 )
                return ret;


        {
                libiodef_string_t *field;

                field = iodef_application_get_url(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"url\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_vendor(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"vendor\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_name(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"name\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_family(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"family\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_swid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"swid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_patch(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"patch\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_version(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"version\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_application_get_configid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"configid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_record_data_json:
 * @ptr: Pointer to an iodef_record_data_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_record_data_print_json(iodef_record_data_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_record_data_t\"");
        if ( ret < 0 )
                return ret;


        {
                iodef_additional_data_t *field;

                field = iodef_record_data_get_additional_data(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"additional_data\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_additional_data_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_record_data_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_record_pattern_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_record_data_get_next_record_pattern(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"record_pattern\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_record_pattern_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_record_data_get_date_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"date_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_application_t *field;

                field = iodef_record_data_get_application(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"application\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_application_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_record_item_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_record_data_get_next_record_item(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"record_item\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_record_item_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_record_data_get_restriction(ptr);

                {
                        const char *enumstr = iodef_record_data_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_record_json:
 * @ptr: Pointer to an iodef_record_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_record_print_json(iodef_record_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_record_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_record_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_record_get_next_record_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"record_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_record_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_record_get_restriction(ptr);

                {
                        const char *enumstr = iodef_record_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_reference_json:
 * @ptr: Pointer to an iodef_reference_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_reference_print_json(iodef_reference_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_reference_t\"");
        if ( ret < 0 )
                return ret;


        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_reference_get_next_url(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"url\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_reference_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_reference_get_reference_name(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"reference_name\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_method_json:
 * @ptr: Pointer to an iodef_method_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_method_print_json(iodef_method_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_method_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_method_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_method_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_reference_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_method_get_next_reference(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"reference\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_reference_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_method_get_restriction(ptr);

                {
                        const char *enumstr = iodef_method_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_time_impact_json:
 * @ptr: Pointer to an iodef_time_impact_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_time_impact_print_json(iodef_time_impact_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_time_impact_t\"");
        if ( ret < 0 )
                return ret;


        {
                libiodef_string_t *field;

                field = iodef_time_impact_get_ext_metric(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_metric\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_time_impact_get_duration(ptr);

                {
                        const char *enumstr = iodef_time_impact_duration_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"duration\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_time_impact_get_metric(ptr);

                {
                        const char *enumstr = iodef_time_impact_metric_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"metric\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_time_impact_get_severity(ptr);

                {
                        const char *enumstr = iodef_time_impact_severity_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"severity\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_time_impact_get_ext_duration(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_duration\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_impact_json:
 * @ptr: Pointer to an iodef_impact_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_impact_print_json(iodef_impact_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_impact_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_impact_get_lang(ptr);

                {
                        const char *enumstr = iodef_impact_lang_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"lang\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_impact_get_completion(ptr);

                {
                        const char *enumstr = iodef_impact_completion_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"completion\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_impact_get_type(ptr);

                {
                        const char *enumstr = iodef_impact_type_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"type\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_impact_get_severity(ptr);

                {
                        const char *enumstr = iodef_impact_severity_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"severity\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_impact_get_ext_type(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_type\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_confidence_json:
 * @ptr: Pointer to an iodef_confidence_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_confidence_print_json(iodef_confidence_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_confidence_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_confidence_get_rating(ptr);

                {
                        const char *enumstr = iodef_confidence_rating_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"rating\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_monetary_impact_json:
 * @ptr: Pointer to an iodef_monetary_impact_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_monetary_impact_print_json(iodef_monetary_impact_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_monetary_impact_t\"");
        if ( ret < 0 )
                return ret;


        {
                libiodef_string_t *field;

                field = iodef_monetary_impact_get_currency(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"currency\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_monetary_impact_get_severity(ptr);

                {
                        const char *enumstr = iodef_monetary_impact_severity_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"severity\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_counter_json:
 * @ptr: Pointer to an iodef_counter_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_counter_print_json(iodef_counter_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_counter_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_counter_get_duration(ptr);

                {
                        const char *enumstr = iodef_counter_duration_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"duration\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_counter_get_type(ptr);

                {
                        const char *enumstr = iodef_counter_type_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"type\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_counter_get_ext_duration(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_duration\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_counter_get_ext_type(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_type\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_assessment_json:
 * @ptr: Pointer to an iodef_assessment_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_assessment_print_json(iodef_assessment_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_assessment_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_impact_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_assessment_get_next_impact(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"impact\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_impact_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_assessment_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_confidence_t *field;

                field = iodef_assessment_get_confidence(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"confidence\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_confidence_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_time_impact_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_assessment_get_next_time_impact(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"time_impact\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_time_impact_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_monetary_impact_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_assessment_get_next_monetary_impact(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"monetary_impact\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_monetary_impact_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_counter_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_assessment_get_next_counter(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"counter\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_counter_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_assessment_get_restriction(ptr);

                {
                        const char *enumstr = iodef_assessment_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_assessment_get_occurrence(ptr);

                {
                        const char *enumstr = iodef_assessment_occurrence_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"occurrence\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_service_json:
 * @ptr: Pointer to an iodef_service_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_service_print_json(iodef_service_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_service_t\"");
        if ( ret < 0 )
                return ret;


        {
                uint32_t *field;

                field = iodef_service_get_proto_code(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"proto_code\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                uint32_t *field;

                field = iodef_service_get_proto_flags(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"proto_flags\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_service_get_portlist(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"portlist\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_application_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_service_get_next_application(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"application\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_application_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                uint32_t *field;

                field = iodef_service_get_proto_type(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"proto_type\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                uint32_t *field;

                field = iodef_service_get_port(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"port\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                uint32_t *field;

                field = iodef_service_get_ip_protocol(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ip_protocol\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_uint32(fd, *field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_address_json:
 * @ptr: Pointer to an iodef_address_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_address_print_json(iodef_address_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_address_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_address_get_category(ptr);

                {
                        const char *enumstr = iodef_address_category_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"category\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_address_get_vlan_name(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"vlan_name\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_address_get_ext_category(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_category\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_address_get_vlan_num(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"vlan_num\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_node_role_json:
 * @ptr: Pointer to an iodef_node_role_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_node_role_print_json(iodef_node_role_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_node_role_t\"");
        if ( ret < 0 )
                return ret;


        {
                int i = iodef_node_role_get_category(ptr);

                {
                        const char *enumstr = iodef_node_role_category_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"category\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_node_role_get_lang(ptr);

                {
                        const char *enumstr = iodef_node_role_lang_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"lang\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_node_role_get_ext_category(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_category\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_node_json:
 * @ptr: Pointer to an iodef_node_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_node_print_json(iodef_node_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_node_t\"");
        if ( ret < 0 )
                return ret;


        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_node_get_next_node_name(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"node_name\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_counter_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_node_get_next_counter(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"counter\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_counter_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_node_get_date_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"date_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_node_role_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_node_get_next_node_role(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"node_role\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_node_role_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_node_get_location(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"location\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_address_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_node_get_next_address(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"address\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_address_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_operating_system_json:
 * @ptr: Pointer to an iodef_operating_system_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_operating_system_print_json(iodef_operating_system_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_operating_system_t\"");
        if ( ret < 0 )
                return ret;


        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_url(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"url\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_vendor(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"vendor\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_name(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"name\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_family(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"family\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_swid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"swid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_patch(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"patch\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_version(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"version\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_operating_system_get_configid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"configid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_system_json:
 * @ptr: Pointer to an iodef_system_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_system_print_json(iodef_system_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_system_t\"");
        if ( ret < 0 )
                return ret;


        {
                iodef_node_t *field;

                field = iodef_system_get_node(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"node\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_node_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_system_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_system_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_service_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_system_get_next_service(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"service\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_service_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_counter_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_system_get_next_counter(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"counter\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_counter_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_operating_system_t *field;

                field = iodef_system_get_operating_system(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"operating_system\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_operating_system_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_system_get_category(ptr);

                {
                        const char *enumstr = iodef_system_category_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"category\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_system_get_restriction(ptr);

                {
                        const char *enumstr = iodef_system_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_system_get_ext_category(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_category\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_system_get_spoofed(ptr);

                {
                        const char *enumstr = iodef_system_spoofed_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"spoofed\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_system_get_interface(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"interface\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_flow_json:
 * @ptr: Pointer to an iodef_flow_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_flow_print_json(iodef_flow_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_flow_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_system_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_flow_get_next_system(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"system\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_system_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_event_data_json:
 * @ptr: Pointer to an iodef_event_data_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_event_data_print_json(iodef_event_data_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_event_data_t\"");
        if ( ret < 0 )
                return ret;


        {
                iodef_time_t *field;

                field = iodef_event_data_get_detect_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"detect_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_flow_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_flow(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"flow\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_flow_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_expectation_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_expectation(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"expectation\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_expectation_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_record_t *field;

                field = iodef_event_data_get_record(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"record\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_record_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_contact_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_contact(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"contact\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_contact_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_event_data_get_start_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"start_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_event_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_event_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"event_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_event_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_event_data_get_end_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"end_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_assessment_t *field;

                field = iodef_event_data_get_assessment(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"assessment\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_assessment_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_method_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_event_data_get_next_method(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"method\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_method_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_event_data_get_restriction(ptr);

                {
                        const char *enumstr = iodef_event_data_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_incident_json:
 * @ptr: Pointer to an iodef_incident_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_incident_print_json(iodef_incident_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_incident_t\"");
        if ( ret < 0 )
                return ret;


        {
                iodef_time_t *field;

                field = iodef_incident_get_detect_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"detect_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_additional_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_incident_get_next_additional_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"additional_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_additional_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_incident_get_end_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"end_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                libiodef_string_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_incident_get_next_description(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"description\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = conv_string(fd, elem);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_contact_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_incident_get_next_contact(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"contact\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_contact_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_alternative_id_t *field;

                field = iodef_incident_get_alternative_id(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"alternative_id\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_alternative_id_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_incident_get_report_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"report_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_time_t *field;

                field = iodef_incident_get_start_time(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"start_time\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_time(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_event_data_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_incident_get_next_event_data(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"event_data\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_event_data_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_related_activity_t *field;

                field = iodef_incident_get_related_activity(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"related_activity\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_related_activity_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_incident_id_t *field;

                field = iodef_incident_get_incident_id(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"incident_id\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_incident_id_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_assessment_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_incident_get_next_assessment(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"assessment\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_assessment_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {

                iodef_method_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_incident_get_next_method(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"method\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_method_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                iodef_history_t *field;

                field = iodef_incident_get_history(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"history\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = iodef_history_print_json(field, fd);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_incident_get_lang(ptr);

                {
                        const char *enumstr = iodef_incident_lang_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"lang\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                int i = iodef_incident_get_restriction(ptr);

                {
                        const char *enumstr = iodef_incident_restriction_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"restriction\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_incident_get_ext_purpose(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"ext_purpose\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_incident_get_purpose(ptr);

                {
                        const char *enumstr = iodef_incident_purpose_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"purpose\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        return do_write(fd, "}");
}

/**
 * iodef_document_json:
 * @ptr: Pointer to an iodef_document_t object.
 *
 * This function will convert @ptr to a json,
 */
int iodef_document_print_json(iodef_document_t *ptr, libiodef_io_t *fd)
{
        int ret;

        if ( ! ptr )
                return 0;

        ret = do_write(fd, "{\"_self\": \"iodef_document_t\"");
        if ( ret < 0 )
                return ret;


        {

                iodef_incident_t *elem = NULL;
                int first = 1;

                while ( (elem = iodef_document_get_next_incident(ptr, elem)) ) {
                        if ( ! first )
                                ret = do_write(fd, ", ");
                        else {
                                first = 0;
                                ret = do_write(fd, ", \"incident\": [");
                        }

                        if ( ret < 0 )
                                return ret;


                        ret = iodef_incident_print_json(elem, fd);
                        if ( ret < 0 )
                                return ret;

                }

                if ( ! first ) {
                        ret = do_write(fd, "]");
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                int i = iodef_document_get_lang(ptr);

                {
                        const char *enumstr = iodef_document_lang_to_string(i);

                        if ( enumstr ) {
                                ret = do_write(fd, ", \"lang\": \"");
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, enumstr);
                                if ( ret < 0 )
                                        return ret;

                                ret = do_write(fd, "\"");
                                if ( ret < 0 )
                                        return ret;
                        }
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_document_get_formatid(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"formatid\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        {
                libiodef_string_t *field;

                field = iodef_document_get_version(ptr);
                if ( field ) {
                        ret = do_write(fd, ", \"version\": ");
                        if ( ret < 0 )
                                return ret;

                        ret = conv_string(fd, field);
                        if ( ret < 0 )
                                return ret;
                }
        }

        return do_write(fd, "}");
}